From f20e990ff487f430ceed5a800fcf61b691e54940 Mon Sep 17 00:00:00 2001
From: Nik Schultz <nschultz@qnx.com>
Date: Thu, 13 Feb 2014 15:00:54 -0500
Subject: [PATCH 51/61] JI:608070 CI:mlapierre added COALESCE to sql query to
 replace null values with an empty string

---
 plugin/com.qnx.car.profile/src/blackberry10/profile.js |    4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/plugin/com.qnx.car.profile/src/blackberry10/profile.js b/plugin/com.qnx.car.profile/src/blackberry10/profile.js
index 0e66820..b5a58e6 100755
--- a/plugin/com.qnx.car.profile/src/blackberry10/profile.js
+++ b/plugin/com.qnx.car.profile/src/blackberry10/profile.js
@@ -229,7 +229,9 @@ module.exports = {
 	 */
 	addToNavigationHistory: function(profileId, location) {
 		var timestamp = Math.floor(new Date().getTime() / 1000);		
-		var query = "SELECT id FROM nav_history WHERE profile_id={0} AND name='{1}' AND ((number='{2}' AND street='{3}' AND city='{4}' AND province='{5}' AND country='{6}') OR (latitude={7} AND longitude={8}))".format(profileId, _qdb.sqlSafe(location.name), _qdb.sqlSafe(location.number), _qdb.sqlSafe(location.street), _qdb.sqlSafe(location.city), _qdb.sqlSafe(location.province), _qdb.sqlSafe(location.country), location.latitude, location.longitude);
+		//Note we use COALESCE in this case as a fix for JI:608070
+		//We should really fix this at the database level and allow the name field to be null
+		var query = "SELECT id FROM nav_history WHERE profile_id={0} AND name=COALESCE('{1}','') AND ((number='{2}' AND street='{3}' AND city='{4}' AND province='{5}' AND country='{6}') OR (latitude={7} AND longitude={8}))".format(profileId, _qdb.sqlSafe(location.name), _qdb.sqlSafe(location.number), _qdb.sqlSafe(location.street), _qdb.sqlSafe(location.city), _qdb.sqlSafe(location.province), _qdb.sqlSafe(location.country), location.latitude, location.longitude);
 
 		//see if this destination is already in the history
 		var result = _qdb.resultToArray(_db.query(query));
-- 
1.7.10.msysgit.1

